<template>
    <div class="slds-grid slds-wrap">
        <div class="slds-col">
            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-size_12-of-12 slds-p-top_medium">
                    <article class="slds-card">
                        <div class="slds-card__header slds-grid">
                            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                <div class="slds-media__body">
                                    <h2 class="slds-card__header-title">
                                        <p href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Add Contacts">
                                            <span>CONTACT INFORMATION</span>
                                        </p>
                                    </h2>
                                </div>
                                <div class="slds-no-flex">
                                    <button class="slds-button slds-button_brand" onclick={addContact}>Add Contact</button>
                                </div>
                            </header>
                        </div>
                         <hr/>
                        <div class="slds-card__body slds-card__body_inner slds-p-top_medium slds-p-bottom--medium">
                            <div class="slds-grid">
                                <div class="slds-col slds-size_12-of-12 slds-p-bottom_medium">
                                    <h4>
                                        <p>
                                            Please identify at least two Primary Contact and one Responsible Representative.
    
                                            The Responsible Representative must be a high-level person from the subapplicant entity who is authorized to commit the entity to request and receive grant funding. The Responsible Representative cannot be a contractor or a consultant.
    
                                            The Primary Contact must be XXXXXXXX
                                        </p>
                                    </h4>
                                </div>
                            </div>
                            <table class="slds-table slds-table_cell-buffer slds-no-row-hover slds-table_bordered slds-table_fixed-layout" role="grid">
                                <thead>
                                <tr class="slds-line-height_reset">
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Title">Title</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="First Name">First Name</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Last Name">Last Name</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Agency">Entity</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Agency">Entity ID</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Email">Email</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Phone">Phone</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Alt Phone">Alt Phone</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Role">Role</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Role">Type</div>
                                    </th>
                                    <th class="" scope="col">
                                        <div class="slds-truncate" title="Action">Action</div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                    <template for:each={recordLocal.Contact_Roles__r} for:item="contactRole" for:index="index">
                                    <tr class="slds-hint-parent" key={contactRole.Contact__r.Email}>
                                        <td role="gridcell">
                                            <div class="slds-truncate">{contactRole.Contact__r.Title}</div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds-truncate">{contactRole.Contact__r.FirstName}</div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds-truncate">{contactRole.Contact__r.LastName}</div>
                                        </td>
                                        <td role="gridcell">
                                            <template if:true={contactRole.Contact__r.Account}>
                                                <div class="slds-truncate">{contactRole.Contact__r.Account.Name}</div>
                                            </template>
                                        </td>
                                        <td role="gridcell">
                                            <template if:true={contactRole.Contact__r.Account}>
                                                <div class="slds-truncate">{contactRole.Contact__r.Account.Entity_Id__c}</div>
                                            </template>
                                        </td>
                                        <td role="gridcell">
                                            <!--<div class="slds-truncate">{contactRole.Contact__r.Email}</div>-->
                                            <div class="slds-truncate">
                                                <lightning-formatted-text value={contactRole.Contact__r.Email} linkify></lightning-formatted-text>
                                            </div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds-truncate">
                                                <lightning-formatted-phone  value={contactRole.Contact__r.Phone}></lightning-formatted-phone>
                                            </div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds-truncate">
                                                <lightning-formatted-phone  value={contactRole.Contact__r.MobilePhone}></lightning-formatted-phone>
                                            </div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds_wrap">{contactRole.Role__c}</div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="slds_wrap">{contactRole.Type__c}</div>
                                        </td>
                                        <td role="gridcell">
                                            <div class="action">
                                                <span data-edit-id={index} onclick={editContactRole}>
                                                    <a>
                                                        <lightning-icon icon-name="utility:edit" size="small" class="slds-p-right_small"></lightning-icon>
                                                    </a>
                                                </span>
                                                <span data-delete-id={index} onclick={deleteContactRole}>
                                                    <a>
                                                        <lightning-icon icon-name="utility:delete" size="small" class="slds-p-right_small"></lightning-icon>
                                                    </a>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                                </tbody>
                            </table>
                        </div>
                    </article>
                </div>
            </div>
            <!--<div class="slds-grid">
                <div class="slds-col slds-p-bottom&#45;&#45;large">
                    <button class="slds-button slds-button_brand" onclick={addContact}>Add Contact</button>
                </div>
            </div>-->
        </div>
    </div>




    <template if:true={showModal}>
        <section role="dialog" tabindex="-1" aria-label="Meaningful description of the modal content" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header slds-modal__header_empty">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"></lightning-icon>
                    </button>
                </header>
                <div class="slds-modal__content" id="modal-content-id-1">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_12-of-12">
                            <article class="slds-card contact-modal">
                                <div class="slds-card__header slds-grid">
                                    <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                        <div class="slds-media__body">
                                            <h2 class="slds-card__header-title">
                                                <p href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="ADDITIONAL INFORMATION">
                                                    <span>CONTACT INFORMATION</span>
                                                </p>
                                            </h2>
                                        </div>
                                    </header>
                                </div>
                                <hr/>
                                <div class="slds-card__body slds-card__body_inner">
                                    <!--<div class="slds-grid slds-wrap">
                                        <div class="slds-col slds-size_12-of-12 slds-p-vertical_medium">
                                            <c-lookup
                                                    selection={contactSelection}
                                                    data-lookup="Contact"
                                                    errors={errors}
                                                    onsearch={handleContactSearch}
                                                    onselectionchange={handleContactSelectionChange}
                                                    placeholder="Select Existing Contact"
                                                    is-multi-entry={isMultiEntry}
                                                    load-data-on-init = {loadLookupDataOnLoad}
                                                    local-search = {loadLookupDataOnLoad}
                                                    scroll-after-n-items = "10"
                                                    required
                                            >
                                            </c-lookup>
                                        </div>
                                    </div>-->
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <!--<div class="slds-col slds-size_12-of-12 slds-p-vertical_medium slds-align_absolute-center">
                                            <p class="slds-text-heading--medium"><b>OR</b></p>
                                        </div>-->
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="Title" class="input" label="Title" data-field="Title" value={contactRec.Title} onchange={fieldChangedContact} type="text" maxlength = "55"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="firstName" class="input" label="First Name" data-field="FirstName" value={contactRec.FirstName} onchange={fieldChangedContact} type="text" maxlength = "40"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="lastName" required class="input" label="Last Name" data-field="LastName" value={contactRec.LastName} onchange={fieldChangedContact} type="text" maxlength = "80"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <!--<c-lookup
                                                    data-custom="lookup"
                                                    selection={agencySelection}
                                                    label="Account"
                                                    data-lookup="Agency__c"
                                                    errors={errorsAgency}
                                                    onsearch={handleAgencySearch}
                                                    onselectionchange={handleAgencySelectionChange}
                                                    placeholder="Search For Account"
                                                    is-multi-entry={isMultiEntry}
                                                    load-data-on-init = {loadLookupDataOnLoad}
                                                    local-search = {loadLookupDataOnLoad}
                                                    scroll-after-n-items = "10"
                                                    required
                                            >
                                            </c-lookup>-->
                                            <lightning-input name="Entity" required class="input" data-field="Name" value={contactRec.Account.Name} label="Entity" onchange={accDetails} type="text" maxlength = "80" disabled=true></lightning-input>
                                        </div>
                                        <!-- <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="EntityID" required class="input" data-field="Entity_Id__c" value={contactRec.Account.Entity_Id__c} label="Entity ID" onchange={accDetails} type="text" maxlength = "100" field-level-help="If you are a Government Entity please enter you FIPS #, if you are Non-Governmental Entity please enter your EIN. Enter N/A if you do not know you FIPS # or EIN."></lightning-input>
                                        </div> -->
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="email" required class="emailField" data-field="Email" value={contactRec.Email} label="Email" onchange={fieldChangedContact} type="text" onblur={handleEmailValidation} placeholder="example@domain.com"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="phone" required class="phoneInput" data-field="Phone" value={contactRec.Phone} label="Phone" onchange={fieldChangedContact} type="tel" onblur={formatPhone} placeholder="(555) 555-5555"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <lightning-input name="altPhone" class="mobilePhoneInput" label="Alternative Phone" data-field="MobilePhone" value={contactRec.MobilePhone} onchange={fieldChangedContact} type="tel" onblur={formatMobilePhone} placeholder="(555) 555-5555"></lightning-input>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <template if:true={rolePicklistValues}>
                                                <lightning-dual-listbox name="Role"
                                                                    data-field="Role__c"
                                                                    value={contactRoleList}
                                                                    source-label="Available"
                                                                    selected-label="Selected"
                                                                    label="Role"
                                                                    options={rolePicklistValues}
                                                                    onchange={handleMultiSelectChange}
                                                                    required
                                                                    class="input"
                                                >
                                                </lightning-dual-listbox>
                                            </template>
                                        </div>
                                        <div class="slds-col slds-large-size_6-of-12 slds-medium-size_6-of-12 slds-size_12-of-12  slds-p-vertical_medium">
                                            <template if:true={typePicklistValues.data}>
                                                <lightning-combobox name="Type"
                                                                    data-field="Type__c"
                                                                    value={type}
                                                                    label="Type"
                                                                    placeholder="Select Type"
                                                                    options={typePicklistValues.data.values}
                                                                    onchange={handleChange}
                                                                    required
                                                                    class="input"
                                                                    dropdown-alignment="auto"
                                                >
                                                </lightning-combobox>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="slds-grid">
                                        <div class="slds-col slds-p-vertical_medium">
                                        <span class="slds-p-right_medium">
                                            <!--<lightning-button variant="brand" label="Add Contact" onclick={addContactToList} class=""></lightning-button>-->
                                            <button class="slds-button slds-button_brand" onclick={addContactToList}>Add Contact</button>
                                        </span>
                                            <span class="slds-p-right_medium">
                                           <!-- <lightning-button variant="brand" label="Clear" onclick={handleClear} class=""></lightning-button>-->
                                            <button class="slds-button slds-button_brand" onclick={handleClear}>Clear</button>
                                        </span>
                                        <span class="slds-p-right_medium">
                                             <button class="slds-button slds-button_brand" onclick={closeModal}>Close</button>
                                         </span>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>















</template>